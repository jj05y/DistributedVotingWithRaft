%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Programming/Coding Assignment
% LaTeX Template
%
% This template has been downloaded from:
% http://www.latextemplates.com
%
% Original author:
% Ted Pavlic (http://www.tedpavlic.com)
%
% Note:
% The \lipsum[#] commands throughout this template generate dummy text
% to fill the template out. These commands should all be removed when 
% writing assignment content.
%
% This template uses a Perl script as an example snippet of code, most other
% languages are also usable. Configure them in the "CODE INCLUSION 
% CONFIGURATION" section.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass{article}

\usepackage{fancyhdr} % Required for custom headers
\usepackage{lastpage} % Required to determine the last page for the footer
\usepackage{extramarks} % Required for headers and footers
\usepackage[usenames,dvipsnames]{color} % Required for custom colors
\usepackage{graphicx} % Required to insert images
\usepackage{listings} % Required for insertion of code
\usepackage{courier} % Required for the courier font
\usepackage{pgfgantt}

% Margins
\topmargin=-0.45in
\evensidemargin=0in
\oddsidemargin=0in
\textwidth=6.5in
\textheight=9.0in
\headsep=0.3in

\linespread{1.1} % Line spacing

% Set up the header and footer
\pagestyle{fancy}
\lhead{\homeworkProblemName} % Top left header
\chead{\hmwkTitle} % Top center head
\rhead{\hmwkClass } % Top right header
\lfoot{} % Bottom left footer
\cfoot{} % Bottom center footer
\rfoot{Page\ \thepage\ of\ \protect\pageref{LastPage}} % Bottom right footer
\renewcommand\headrulewidth{0.4pt} % Size of the header rule
\renewcommand\footrulewidth{0.4pt} % Size of the footer rule

\setlength\parindent{0pt} % Removes all indentation from paragraphs

%----------------------------------------------------------------------------------------
%	CODE INCLUSION CONFIGURATION
%----------------------------------------------------------------------------------------

\definecolor{MyDarkGreen}{rgb}{0.0,0.4,0.0} % This is the color used for comments
\lstloadlanguages{Java} % Load Java syntax for listings, for a list of other languages supported see: ftp://ftp.tex.ac.uk/tex-archive/macros/latex/contrib/listings/listings.pdf
\lstset{language=Java, % Use Java in this example
        frame=none, % Single frame around code
        basicstyle=\small\ttfamily, % Use small true type font
        keywordstyle=[1]\color{Blue}\bf, % Perl functions bold and blue
        keywordstyle=[2]\color{Purple}, % Perl function arguments purple
        keywordstyle=[3]\color{Blue}\underbar, % Custom functions underlined and blue
        identifierstyle=, % Nothing special about identifiers                                         
        commentstyle=\usefont{T1}{pcr}{m}{sl}\color{MyDarkGreen}\small, % Comments small dark green courier font
        stringstyle=\color{Purple}, % Strings are purple
        showstringspaces=false, % Don't put marks in string spaces
        tabsize=8, % 5 spaces per tab
        %
        % Put standard Perl functions not included in the default language here
        morekeywords={rand},
        %
        % Put Perl function parameters here
        morekeywords=[2]{on, off, interp},
        %
        % Put user defined functions here
        morekeywords=[3]{test},
       	%
        morecomment=[l][\color{Blue}]{...}, % Line continuation (...) like blue comment
        numbers=left, % Line numbers on left
        firstnumber=1, % Line numbers start with line 1
        numberstyle=\tiny\color{Blue}, % Line numbers are blue and small
        stepnumber=100 % Line numbers go in steps of 5
}


%----------------------------------------------------------------------------------------
%	DOCUMENT STRUCTURE COMMANDS
%	Skip this unless you know what you're doing
%----------------------------------------------------------------------------------------

% Header and footer for when a page split occurs within a problem environment
\newcommand{\enterProblemHeader}[1]{
\nobreak\extramarks{#1}{#1}\nobreak
\nobreak\extramarks{#1}{#1}\nobreak
}

% Header and footer for when a page split occurs between problem environments
\newcommand{\exitProblemHeader}[1]{
\nobreak\extramarks{#1}{#1 continued on next page\ldots}\nobreak
\nobreak\extramarks{#1}{}\nobreak
}

\setcounter{secnumdepth}{0} % Removes default section numbers
\newcounter{homeworkProblemCounter} % Creates a counter to keep track of the number of problems

\newcommand{\homeworkProblemName}{}
\newenvironment{homeworkProblem}[1][
 \arabic{homeworkProblemCounter}]{ % Makes a new environment called homeworkProblem which takes 1 argument (custom name) but the default is "Problem #"
\stepcounter{homeworkProblemCounter} % Increase counter for number of problems
\renewcommand{\homeworkProblemName}{#1} % Assign \homeworkProblemName the name of the problem
\section{\homeworkProblemName} % Make a section in the document with the custom problem count
\enterProblemHeader{} % Header and footer within the environment
}{
\exitProblemHeader{} % Header and footer after the environment
}

\newcommand{\problemAnswer}[1]{ % Defines the problem answer command with the content as the only argument
\noindent\framebox[\columnwidth][c]{\begin{minipage}{0.98\columnwidth}#1\end{minipage}} % Makes the box around the problem answer and puts the content inside
}

\newcommand{\homeworkSectionName}{}
\newenvironment{homeworkSection}[1]{ % New environment for sections within homework problems, takes 1 argument - the name of the section
\renewcommand{\homeworkSectionName}{#1} % Assign \homeworkSectionName to the name of the section from the environment argument
\subsection{\homeworkSectionName} % Make a subsection with the custom name of the subsection
\enterProblemHeader{\homeworkProblemName\ [\homeworkSectionName]} % Header and footer within the environment
}{
\enterProblemHeader{\homeworkProblemName} % Header and footer after the environment
}


%----------------------------------------------------------------------------------------
%	NAME AND CLASS SECTION
%----------------------------------------------------------------------------------------

\newcommand{\hmwkTitle}{Group Project: A Fault Tolerant Voting Service} % Assignment title
\newcommand{\hmwkDueDate}{We're not even sure} % Due date
\newcommand{\hmwkClass}{COMP30220} % Course/class
\newcommand{\hmwkClassTime}{Distributed Systems} % Class/lecture time
\newcommand{\hmwkClassInstructor}{Dr. Rem Collier} % Teacher/lecturer
\newcommand{\hmwkAuthorName}{Group Name: Lamp + Gary} % Your name

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\title{
\vspace{2in}
\textmd{\textbf{\hmwkClass:\ \hmwkClassTime}}\\
\normalsize\
\vspace{0.1in}\large{\textit{\hmwkClassInstructor}}\\
\vspace{0.2in}
\textmd{\textbf{\hmwkTitle}}\\
\small{Due\ on\ \hmwkDueDate}\\
\vspace{.5in}
}

\author{\textbf{\hmwkAuthorName}\\
Joe Duffin - 13738019
\\Niamh Kavanagh - 12495522
\\Edwin Keville - 13718661
\\Gary Mac Elhinney - XXXXXXXX
}

\date{} % Insert date here if you want it to appear below your name

%----------------------------------------------------------------------------------------

\begin{document}
\begin{titlepage}
\maketitle
\thispagestyle{empty}
\end{titlepage}

\newpage
%----------------------------------------------------------------------------------------
%	TABLE OF CONTENTS
%----------------------------------------------------------------------------------------

%\setcounter{tocdepth}{1} % Uncomment this line if you don't want subsections listed in the ToC

\newpage
\tableofcontents
\newpage

%----------------------------------------------------------------------------------------

\begin{homeworkProblem}[Project Description]
This will pretty much be a re-itteration of the proposal, but we're no longer using uddi
\newpage
\end{homeworkProblem}
%----------------------------------------------------------------------------------------

\begin{homeworkProblem}[Technologies Used]
so info on the technologies and a sentance on how we used them/what we used them for

\begin{homeworkSection}{Jax-WS}
To publish server end points
\end{homeworkSection}

\begin{homeworkSection}{Java RMI}
to maintain a list of active servers
\end{homeworkSection}

\begin{homeworkSection}{SQLite}
each server has it's own sql db, used to keep track of votes.
\end{homeworkSection}
\newpage
\end{homeworkProblem}

%----------------------------------------------------------------------------------------

\begin{homeworkProblem}[The Raft Alogorithm]

\begin{homeworkSection}{Basic Principle}
It is an algorithm for comming to data concensus between multiple servers.\\
Each server has 3 states (follower, candidate, leader)\\
The alogrithm plays out as follower
\begin{enumerate}
\item Every server starts as as follower
\item A leader is elected
\item That leader sends out heart beat messages with data
\item If no heart beat is sent out a new leader is elected
\end{enumerate}

\end{homeworkSection}

\begin{homeworkSection}{Electing a leader}
Explicit Steps
\begin{enumerate}
\item If no hearbeat is detected by a follower, who evers election count down timer runs out first puts him self up for election
\item That server becomes a candidate and a new election term is started and they request votes from other servers
\item Follower servers vote once per term to the candidate server that first requests a vote from them
\item When a candidate server recieves a majority of votes it is now the leader and starts heart beats
\item if a tie is reached (no majority) then no action is taken and election count down timers restart

\end{enumerate}
\end{homeworkSection}

\begin{homeworkSection}{Heart Beats}
\begin{enumerate}
\item With each heart beat from the leader data is distributed
\item Follower servers acknoledge reciept of the data but do not commit it to memory yet
\item Only when the leader knows that a majority of follower servers have recieved the data does the leader instruct the followers to commit the data
\item A leader will continue sending heart beat messages indefinately (until it crashes)
\end{enumerate}

\end{homeworkSection}
\newpage
\end{homeworkProblem}

%----------------------------------------------------------------------------------------

\begin{homeworkProblem}[Our Implementation]
We loosly interpreted the Raft algorithm to design a distributed voting service. When I say voting I mean a voting service distinct to that of the leader election. A system such as this could be used for keeping track of the number of votes for each candidate in a presedential election.\\
We took from raft the notion of leader election and the heart beat messages but in order to keep the system as fault tolerant as possible we had to bolster the code with lots of support.\\

Our implementation has 3 core components.


\begin{homeworkSection}{jgUDDI}
For our distributed voting service we needed a means of publishing the endpoints of a service which is detectable and reachable by the other systems, whether they be servers or clients. UDDI (Universal Description, Discovery, and Integration) is an XML-based standard for describing, publishing, and finding web services. This standard defines a methodology for publishing services in a way in which we need but we found the java implementation (jUDDI) to be way too heavy weight. \\

We implemented our own UDDI service called jgUDDI (Joe and Gary UDDI). We used JAVA RMI to host an instance of our jguddi service. The service is responsible for yielding the published endpoint of current leader at any one time as well as the published endpoints of all other servers. When ever a new server comes online it publishes its endpoint to jgUDDI. When a new leader is elected jgUDDI is updated with the end point of the new leader.\\

The jgUDDI service is owned by one single server but is not a single point of fialure. Should the hosting server crash, thus killing the jgUDDI service, the next online server to query jgUDDI will realise it is down, re-start the service and re-populate it's endpoint list with a local copy. This server is now the owner of jgUDDI. The owner of jgUDDI is fully independant of the notion of the current Raft leader.

\end{homeworkSection}

\begin{homeworkSection}{Clients}
The clients are a simple part of our project. It is a command line based implementation where the user is prompted to either vote for a candidate or print the current results.\\

For every interaction from the client, the client first looks to jgUDDI, gets the endpoint of the current leader, and then either votes to or queries that server for results. It is the servers responsiblity to replicate the data to all other raft servers. The client is ignorant as to which server it is dealing with at any time.

\end{homeworkSection}

\begin{homeworkSection}{Servers}
The server is the core of our project. Any number of servers can be brought online at any one time. Any server can be killed at any time (including the current leader) without an interuption to the distributed voting service. The client only sees an interface where it can vote or request results. This interface could be an instance of any one of the servers at any given time. Every server is exactly the same. Each server intermittently checks the jgUDDI service to establish if more servers have come online, or if a known server has gone offline.\\

The server has three main components.

\begin{description}
\item \textbf{The Raft Element}\\
Each server is controlled by 2 threads in charge of the two countdown timers (the election count down timer and the heartbeat count down timer). When a server is first brought online it publishes its self and it's election countdown timer is started. During this time period it waits to recieve hearbeats from the current leader. If no heart beat is detected, it will put its self up for election.\\

If the server is elected as leader its election countdown timer stops and its heart beat countdown timer starts. When each "pulse" time period has elapsed the server will call recieveHeartBeat on every server known to it at that time. With this heart beat will travel any voting data recieved since the last heart beat. The leader looks for acknowledgement of heart beats from a majority of servers and only once this majorty is reached, the leader instructs all servers to commit the data to their data base.

\item \textbf{The Coordinator}\\
It is the responsibility of the cooridinator to be the middle man between the database and the server. When a server is informed of a new vote via a heart beat, it is the coordinator that holds this vote until the instruction to commit it to the data base is recieved.\\

When a client requests the current state of the database from a server, the server puts that responsibility on the coridinator to request this information from the database and returns it to the server. The server then returns the data back to the client.

\item \textbf{The Database}\\
Each server uses an SQLite database to keep track of the current vote counts. It is only when data concensus has be reached between the servers (a majority of servers have acknlowedged reciept of the new data) that the new data is committed to the data base. We used an SQLite database so that our solution is scalable past the toy example that we implemented.
\end{description}

\end{homeworkSection}
\newpage
\end{homeworkProblem}

%----------------------------------------------------------------------------------------

\begin{homeworkProblem}[Conclusion]

it was fab
\end{homeworkProblem}



\end{document}